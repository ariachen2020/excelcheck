# 求和驗證功能使用指南

## 概述

「求和驗證」功能可以幫助你驗證 Excel 檔案中某個儲存格範圍的求和是否等於指定的目標儲存格。

**重要：** 此功能只支持 `.xlsx` 格式的 Excel 檔案。

## 基本概念

### 儲存格範圍

儲存格範圍定義了你想要求和的區域。支持以下格式：

| 格式 | 範例 | 說明 |
|------|------|------|
| 單個儲存格 | `A1` | 只驗證 A1 這一個儲存格 |
| 單列範圍 | `A1:A10` | 驗證 A1 到 A10 共 10 個儲存格 |
| 單列範圍 | `B5:B15` | 驗證 B5 到 B15 共 11 個儲存格 |
| 跨列範圍 | `A1:C10` | 驗證 A1 到 C10 的矩形範圍（3 列 × 10 行 = 30 個儲存格） |
| 跨列範圍 | `A2:D5` | 驗證 A2 到 D5 的矩形範圍（4 列 × 4 行 = 16 個儲存格） |

**格式提示：**
- 儲存格位置不區分大小寫（`a1` 和 `A1` 相同）
- 列用字母表示（A, B, C, ..., Z, AA, AB, ...）
- 行用數字表示（1, 2, 3, ...）
- 範圍使用冒號 `:` 分隔起點和終點

### 目標儲存格

目標儲存格是包含「應該等於的求和結果」的儲存格。例如：

```
如果 Excel 中：
  A1 = 100
  A2 = 200
  A3 = 150
  B1 = 450

那麼驗證 A1:A3 範圍的求和是否等於 B1：
  結果：✅ 通過（100 + 200 + 150 = 450）
```

## 使用步驟

### 第 1 步：準備 Excel 檔案

1. 打開或創建一個 `.xlsx` 格式的 Excel 檔案
2. 在某些儲存格中輸入數值
3. 在另一個儲存格中計算或輸入求和結果
4. 保存檔案為 `.xlsx` 格式

**範例檔案內容：**
```
     A      B      C
1   100    450
2   200
3   150
4
```

### 第 2 步：上傳檔案

1. 在應用中點擊「Tab 2: 求和驗證」
2. 點擊「上傳 Excel 檔案」
3. 選擇你的 `.xlsx` 檔案
4. 等待上傳完成（會顯示 ✓ 已上傳）

### 第 3 步：輸入儲存格位置

1. **儲存格範圍**：輸入你想要求和的範圍
   - 例如：`A1:A3`

2. **目標儲存格**：輸入包含預期求和結果的儲存格
   - 例如：`B1`

### 第 4 步：驗證

1. 點擊「✓ 驗證求和」按鈕
2. 等待驗證完成

### 第 5 步：查看結果

驗證完成後，你會看到：

**如果通過：**
```
✅ 驗證通過！

- 範圍: A1:A3
- 儲存格數量: 3
- 求和結果: 450
- 目標值 (B1): 450
- 狀態: ✅ 相等
```

**如果失敗：**
```
❌ 驗證失敗！

- 範圍: A1:A3
- 儲存格數量: 3
- 求和結果: 450
- 目標值 (B1): 500
- 誤差: 50
```

## 實際範例

### 範例 1：簡單的求和檢驗

**Excel 檔案內容：**
```
     A      B      C
1   50
2   30
3   20
4          100
```

**驗證步驟：**
1. 儲存格範圍：`A1:A3`
2. 目標儲存格：`B4`
3. 結果：✅ 通過 (50 + 30 + 20 = 100)

### 範例 2：跨多列的求和

**Excel 檔案內容：**
```
     A      B      C      D
1   10     20     30
2   40     50     60
3          300
```

**驗證步驟：**
1. 儲存格範圍：`A1:C2`（2 行 × 3 列 = 6 個儲存格）
2. 目標儲存格：`B3`
3. 計算：10 + 20 + 30 + 40 + 50 + 60 = 210
4. 結果：❌ 失敗 (期望 300，實際 210)

### 範例 3：非連續行的求和

**Excel 檔案內容：**
```
     A      B
1   100
2
3   200
4          300
```

**驗證步驟：**
1. 儲存格範圍：`A1:A3`（包括空行）
2. 目標儲存格：`B4`
3. 結果：✅ 通過 (100 + 0 + 200 = 300)
4. 說明：空值會被視為 0

## 常見問題

### Q: 我的檔案是 .xls 格式，可以用嗎？

A: 不行，目前只支持 `.xlsx` 格式。你可以：
   1. 在 Excel 中打開 `.xls` 檔案
   2. 選擇「另存新檔」
   3. 選擇格式為 `.xlsx`
   4. 保存後上傳

### Q: 儲存格中有公式，可以驗證嗎？

A: 可以，只要儲存格中有計算結果。應用會讀取儲存格的值，而不是公式。

### Q: 如果範圍中有文字怎麼辦？

A: 應用會忽略非數值的儲存格。只有數字會被計入求和。

**範例：**
```
A1 = "金額"      (文字，忽略)
A2 = 100         (數字)
A3 = 200         (數字)
A4 = "總計"      (文字，忽略)
```
求和 = 100 + 200 = 300

### Q: 為什麼顯示誤差而不是完全失敗？

A: 由於浮點數的精度限制，應用允許極小的誤差（小於 1e-9）。這是正常的。

**例如：**
- 目標值：450.00000000001
- 計算值：450
- 誤差：0.00000000001（< 1e-9）
- 結果：✅ 通過（視為相等）

### Q: 如何驗證多個不同的範圍？

A: 每次驗證一個範圍。如果需要驗證多個，可以：
   1. 驗證第一個範圍
   2. 修改「儲存格範圍」
   3. 修改「目標儲存格」（如需要）
   4. 點擊「✓ 驗證求和」重新驗證

### Q: 能驗證不同工作表的儲存格嗎？

A: 目前不支持。應用只能驗證第一個工作表（Sheet1）的儲存格。

## 高級技巧

### 驗證不同列的求和

如果你想驗證不同列中特定儲存格的求和，需要在 Excel 中創建一個輔助欄，然後驗證該欄。

**例如：如果要驗證 A1、C1 和 E1 的求和：**

1. 在 Excel 中，在某個儲存格（例如 F1）輸入：`=A1+C1+E1`
2. 在應用中驗證：`F1:F1` 是否等於 `B1`（你的目標儲存格）

### 批量驗證

如果需要驗證多個類似的範圍，可以：
1. 在 Excel 中創建多個目標儲存格（每行一個）
2. 逐個驗證每個範圍

**範例：**
```
驗證 1：A1:A3 -> B1
驗證 2：A4:A6 -> B2
驗證 3：A7:A9 -> B3
```

## 導出和分享

目前應用的驗證結果無法直接導出，但你可以：
1. 截圖驗證結果
2. 複製結果信息
3. 手動記錄在 Excel 中

## 性能提示

- 驗證大範圍（超過 10,000 個儲存格）可能需要幾秒鐘
- 小範圍（< 1000 個儲存格）通常在 1 秒以內完成

## 故障排除

| 問題 | 原因 | 解決方案 |
|------|------|--------|
| "目標儲存格為空" | 目標儲存格沒有值 | 檢查儲存格位置是否正確，確保該儲存格有值 |
| "無法讀取檔案" | 檔案損壞或格式不支持 | 嘗試在 Excel 中重新保存為 .xlsx |
| 儲存格範圍返回 0 | 範圍內沒有數值 | 檢查儲存格是否有值，確保不是空或文字 |
| 誤差很大 | 計算錯誤或儲存格值有誤 | 檢查 Excel 中的實際值 |

## 反饋和建議

如有問題或建議，歡迎在 GitHub 上提出 Issue：
https://github.com/ariachen2020/excelcheck/issues

祝你使用愉快！
